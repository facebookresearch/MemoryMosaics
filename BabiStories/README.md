# BabiStories Generated by Mixtral8x7b


We include the generated BabiStories (train set and test set) in `data/babistories-dataset.7z.[001-005]`. To use the BabiStories dataset, simply extract them by `7z x babistories-dataset.7z`. Alternatively, one can reproduce the story generation process as follow:

## Generation process 

### Requirements 

- bitsandbytes>=0.43
- accelerate>=0.29
- datasets==2.12.0      #for babistories dataset generation 
- transformers>=4.38.0  #for babistories dataset generation 

### 1) Generate story startings (389,967) ranging from 1 to 12 words by Mixtral8x7b

Examples:
- In
- In a
- In a hidden valley,
- In a hidden valley, full of vibrant colors

<!-- We include the generated story startings in `data/allstartings.txt`. Alternatively, one can reproduce these startings (up to some randomness) by the following scripts: -->

To generate these startings, use the following scripts:

```sh
python generate_starting.py --idx [0-127]    --prompt "Please give me 100 ways to open children's story. Avoid repeated first words! Remember to only use simple words!"
python generate_starting.py --idx [0-127]p2  --prompt "Please give me 100 ways to open children's story. Remember to only use simple words!"
```


### 2) Generate character (3,984) names by Mixtral8x7b

Examples:
- Novak
- Hudson
- Dyllan

<!-- We include the generated character names in `data/allnames.txt`. Again one can reproduce these names by the followiing scripts: -->

To generate these startings, use the following scripts:
```sh
python generate_names.py --idx [0-127]
```


### 3) Generate stories with a certain name and story starting.

<p align="center">
<image src="figure/storygen.png" width="600" />
</p>

<p align="center">
<em>
Fig1: Generation of BabiStories. In order to improve the diversity of the generations, each story is generated by a prompt that provides a list of required words and story features (as in Eldan and Li, 2023) and additionally provides first names and opening words.
</em>
</p>

Stories Generation: 

* Download story generation prompts from [here](https://huggingface.co/datasets/roneneldan/TinyStories/blob/main/TinyStories_all_data.tar.gz), extract all files to foler `metaprompt/`. 

* Then go to 'metaprompt' folder and split prompt files into small groups by `split_data.py` for the ease of parallelization. 

* Finally, generate BabiStories by the following script (where ${data} ranges from 0 to 24, ${subdata} ranges from 0 to 99): 
```sh
python generate.py --data_idx ${data} --sub_data_idx ${subdata} 
```

### 4) Cleaning generated stories

Go to `data/` folder and clean the generated stories by the following script:
```sh
python filter_tinystories.py
```

